/* eslint-disable max-len */
/* eslint-disable no-inline-comments */
/* eslint-disable comma-spacing */
/* eslint-disable max-statements */

import test from 'tape';
import {normalizeArray, doPCA} from '../src/pca';
import {default as AlmostEqual, FLT_EPSILON} from 'almost-equal';

const equalish = (leftArr, rightArr) =>
  leftArr.every((row, idx) => AlmostEqual(leftArr[idx], rightArr[idx], 100 * FLT_EPSILON));

const equalishSgn = (leftArr, rightArr) =>
    (leftArr.every((row, idx) => AlmostEqual(leftArr[idx], rightArr[idx], 100 * FLT_EPSILON)) ||
     leftArr.every((row, idx) => AlmostEqual(leftArr[idx], -rightArr[idx], 100 * FLT_EPSILON)));

test('normalizeArray', t => {
  t.ok(equalish(normalizeArray(['0', '0']),
    [0, 0]), 'normalizeArray([0,0]); checking for stdv=0');
  t.ok(equalish(normalizeArray(['0', '1']),
    [-1, 1]), 'normalizeArray([0,1])');
  t.ok(equalish(normalizeArray([-0.5,1.024,0,0.001,0.004,0.064,0.128,0.256,0.512,0.008,0.016,0.032]),
    [-1.8092880611200997, 2.5761672154556963, -0.37049039820153135, -0.3676128028756942, -0.35898001689818276, -0.18632429734795458, -0.002158196494377854, 0.3661740052127756, 1.1028384086270824, -0.3474696355948342, -0.3244488729881371, -0.27840734777474296]), 'normalizeArray([various fractions])');
  t.ok(equalish(normalizeArray(['-1.2247448713915889', '0', '1.2247448713915889']),
    [-1.2247448713915889, 0, 1.2247448713915889]), 'normalizeArray on pre-normalized array');
  t.ok(equalish(normalizeArray(['0', '1', '2', '3', '4', '5']),
    [-1.4638501094227998, -0.8783100656536799, -0.29277002188455997,
      0.29277002188455997, 0.8783100656536799, 1.4638501094227998]), 'normalizeArray([0..5])');
  t.ok(equalish(normalizeArray(['0', '1', '0', '0']),
    [-0.5773502691896258, 1.7320508075688774, -0.5773502691896258,
      -0.5773502691896258]), 'normalizeArray([0,1,0,0])');
  t.end();
});

// const A = [0, 2, 2, 4, 5];
// console.log('const nA =', normalizeArray(A));
const nA0 = [-1.4912022701586516, -0.3441236008058427, -0.3441236008058427, 0.8029550685469662, 1.3764944032233706];
// const B = [0, 1, 3, 3, 5];
// console.log('const nB =', normalizeArray(B));
const nB0 = [-1.3764944032233706, -0.8029550685469662, 0.3441236008058427, 0.3441236008058427, 1.4912022701586516];
const pcaData0 = doPCA({A: nA0, B: nB0}, {A: true, B: true});

// result of calling normalizeData on CSV contents
const ndata = {
  HigherEducation: [-1.2150208210522384, 0.8196476708458996, 0.3762772571542173, -1.7437612339827333, 0.20934225467582493, 1.6457939369300307, 0.4125952609797705, -0.680092599276753, 2.260557231591852, -0.4507690102947856, -0.42107446002059773, 0.5874470993596007, 0.32744791945693885, 0.38639518760967767, -1.1859231585742338, -0.04112946652623403, 0.6602804451913724, -1.423513564833469, -1.9933838575467122, -0.277186844698895, 0.7407287597049748, 0.9737711110187532, 0.05807691569792683, 1.3121979770337693, -1.4384998864069811, -0.3781570458488067, 0.5706032963214953, 0.6934077303736567, -0.7423390588614737, 0.9416642802825972, 0.1524992512499416, -0.39259733865796625, -0.1357979824045895, 0.12047530413878448, 0.8419962066918867, -0.7875471643076754, -0.8048105484367143, 1.2364950959478878, -1.1089563062489105, -0.02154326883657042, -0.6105417520514854, 0.2571101386486507, -1.1933956350040014, -0.5905057023161178, 1.560886554825611, 0.37961495757147146, 0.8415016731419267, 1.4697069219597072, -2.767912639533801, -0.001701426779553805, 0.5696403340971765],
  InfantMortality: [2.147250704765591, 0.3226752306662382, -0.41773220809871653, 1.3627713946455793, -1.3961277521809785, -1.087624652695581, -0.8760796701913081, 1.1864839092253519, 1.3804001431876025, 0.06705837680690852, 1.1952982834963637, -0.5146903250798418, -0.7703071789391716, 0.08468712534893087, 0.992567675263102, -1.4754571206200808, 0.11113024816196519, 0.5782920845255679, 1.618388248504909, 0.6135495816096134, 0.4284477219183747, -1.5900439861432285, 0.5254058388994992, -0.8760796701913081, 2.6408556639422276, 0.2609746107691584, -0.320774091117592, -0.664534687687035, -0.6557203134160239, -1.2286546410317623, -1.3696846293679443, -0.7791215532101827, -1.2022115182187287, 0.9484958039080452, 0.014172131180839877, 0.9220526810950109, 1.1776695349543407, -0.9025227930043423, 0.12875899670398835, -0.41773220809871653, 0.5782920845255679, 0.3491183534792725, 0.6928789500487156, -0.25907347122051216, -0.9201515415463647, -1.3961277521809785, -0.15330097996837566, -1.2815408866578308, 1.001382049534113, -0.1444866056973645, -0.6292771906029895],
  MoreDemocrat: [-1.0383156027129443, -0.7697676389147095, -0.30729307660094296, -1.0429245233591262, 1.1415114870153695, 0.2775615156536357, 0.7719222483136603, 0.7906581555645877, 3.7366969711970133, 0.029115907755739398, -0.26542094230864866, 1.7701197382003615, -1.354396496330462, 0.8611428497776318, -0.41575571272878215, 0.08242813558474275, -0.8446521157560951, -1.0116215643598965, -0.8088383236630201, 0.42247509130919747, 1.139613975893624, 1.121179634567455, 0.3764284180420366, 0.2845517747141612, -0.6107725410045971, -0.4086179918677281, -0.5465117888928337, -0.9785333331587358, 0.303690101047883, 0.22142389616962968, 0.6804183008277204, 0.5030744131024066, 1.120504908575901, -0.08403184851730694, -0.9781698076946423, -0.008245498927544656, -1.4688103618259747, 0.5885074729474002, 0.2120886182786469, 1.0374374159032522, -0.4973866411041012, -0.8272513663394848, -0.8947206482468812, -0.5292974332954348, -1.496691974643596, 1.4895137492445916, 0.22243650162683656, 0.7103296424045645, -1.2032176455437467, 0.2907375186127888, -1.7943235645334898],
  MoreDemocrat08: [-1.1762952224815533, -1.1919536655795004, -0.5840227874455383, -1.111531405048589, 0.9101521681116, 0.2142622654763937, 0.8236921853723226, 0.9425429007458869, 3.71278038838942, -0.06770395865356547, -0.43223420573666327, 1.8750846321343453, -1.368438089252967, 0.9511991884095572, -0.1485442659257025, 0.24109508297766205, -0.8810481861963015, -0.9369841686898264, -1.0471850412815236, 0.5995694793128384, 0.9688334709480093, 0.9928765473803075, 0.5583055277733501, 0.27536863690960195, -0.7936666573508696, -0.2016328773938834, -0.3008543858582024, -0.8807598938960749, 0.3795915450933807, 0.24287481117348597, 0.5126787083234977, 0.4946926281073722, 1.0270605611167074, -0.18060190390779401, -0.592555718917592, 0.014619879020057824, -1.6044186721531808, 0.5621254992878593, 0.27539824782890127, 1.0830239768129823, -0.6047823458774703, -0.5823844270035348, -0.8827768236209586, -0.730090437269687, -1.5036756790680468, 1.5063625890033001, 0.09105097362561981, 0.5925906101697753, -0.7965314624987077, 0.43983096622679135, -1.6869911886232176],
  MoreDemocrat12: [-0.943154702108982, -0.6152698540053531, -0.3881666745378392, -1.0220111103126464, 0.9975442203409941, 0.23057711805442596, 0.7369608330046112, 0.7936441595060288, 3.5792130064012557, 0.03677348790207935, -0.3329665707387286, 1.8238706426862845, -1.3806629422240675, 0.720565986915567, -0.4375052075967786, 0.24834282607537977, -0.9345055165182848, -0.9706016347779451, -0.7355944203661187, 0.6602495145284053, 1.1193295819538673, 0.9902206632228732, 0.4030992112104696, 0.3308721505671314, -0.4880650472962469, -0.40205947364306277, -0.5916460843016756, -0.9358557009405282, 0.28601447972661964, 0.23778579596412766, 0.7549711386437572, 0.4446778367096543, 1.2016314771790837, -0.08731260272740082, -0.8508366819436763, 0.12690725907480335, -1.4101598424305457, 0.5267102407753295, 0.22922770781427404, 1.1777479897943526, -0.4465728349481397, -0.775239910692078, -0.8704358149847459, -0.6734854038562392, -2.070299701030181, 1.5333345292263834, 0.16496450877151497, 0.6407809376175425, -1.1497623442468672, 0.2951628090285059, -1.779010036467142],
  MoreDemocrat16: [-0.9748193550431972, -0.5024804286594955, 0.009859091236428197, -0.9677990609340926, 1.4310386519153109, 0.3705802131609308, 0.7222195204752946, 0.6320718246059666, 3.7631177623158703, 0.11012337376409582, -0.050964898172664794, 1.5346100607595388, -1.2852719047276568, 0.8703855303224102, -0.6390637957563277, -0.24045098833167694, -0.7174777099601084, -1.0770789642712857, -0.6433520206878757, 0.28457717556663414, 1.264458055856681, 1.3145456362536319, 0.1496526787655787, 0.22454597805498697, -0.5580232524490107, -0.6155001618949896, -0.7173352606375418, -0.9095761506706621, 0.2609743511931245, 0.17447421306530195, 0.7334703829161914, 0.5257627141056705, 1.0874788347408537, 0.008776743907135405, -1.4035099679110459, -0.17767768960821048, -1.3637173481692824, 0.6444722727423051, 0.12931350752532966, 0.8144361334466694, -0.4294901180951851, -1.1008382488731128, -0.9156792291950908, -0.21281950286197304, -0.8178208620442142, 1.3567551258149473, 0.38186264738540876, 0.8519982972955631, -1.589007699879368, 0.12675377595189394, -1.8685599343097665],
  Obesity: [1.5957925394488162, 0.4343013217218823, -0.21397284631175426, 1.5957925394488162, -1.2944297930344824, -2.023738232072324, -1.0243155563538004, 0.24522135604540504, -1.942703961068119, -0.6461556250008459, 0.4343013217218823, -1.6185668770513006, -0.6461556250008459, 0.48832416905801945, 0.731426982070633, 0.5963698637302919, 0.3802784743857461, 1.1906211844277932, 1.5417696921126791, 0.029129966700859204, 0.029129966700859204, -1.6725897243874368, 0.731426982070633, -0.5381099303285725, 2.027975318137906, 0.5153355927260871, -1.1593726746941415, 0.5963698637302919, -1.0783384036899366, -0.8622470143453907, -0.6461556250008459, -0.4030528119882315, -1.1593726746941415, 0.5423470163941556, 0.5693584400622232, 0.4613127453899509, 0.8124612530748367, -0.2950071173159591, 0.13717566137313258, -0.8622470143453907, 0.6774041347344957, -0.05190430430334464, 1.3526897264362008, 1.0555640660874521, -1.18638409836221, -0.7271898960050498, -0.21397284631175426, -0.3220185409840267, 2.1360210128101804, 0.24522135604540504, -0.5651213539966411],
  Poverty: [1.2215696389178916, -0.6087909625945516, 1.3232563390019163, 1.153778505528542, 0.4080760382456945, -1.1850155964040248, -1.0833288963199998, -0.473208695815852, 1.289360772307241, 0.6453450051084183, 1.3910474723912658, -0.8799554961519508, -0.337626429037153, -0.4054175624265025, 0.0013292379095956903, -0.8799554961519508, 0.0013292379095956903, 1.5944208725593143, 2.2723322064528118, -0.06646189547975381, -1.4561801299614234, -0.7104776626785765, -0.2698352956478029, -1.4900756966560982, 2.509601173315537, -0.43931312912117726, -0.30373086234247765, -0.9477466295413003, -0.4054175624265025, -1.9985091970762214, -0.8121643627626007, 2.035063239590088, 0.10301593799362055, 0.5775538717190688, -0.6087909625945516, 0.30638933816166963, 0.5775538717190688, -0.30373086234247765, -0.337626429037153, -0.37152199573182776, 0.5097627383297187, 0.5097627383297187, 0.7131361384977685, 0.543658305024394, -1.286702296488049, -0.846059929457276, -0.5409998292052021, -0.5071042625105273, 1.2215696389178916, -0.5409998292052021, -0.8121643627626007],
  SNAP: [1.0844196953017675, -0.21318622769872145, 0.09727821488584402, 0.04400649797619185, -0.6870916978570832, -1.330981624150915, -0.3887957913977157, 0.7321551284237817, 1.442314840939267, 0.7047766547732114, 0.8191944770572533, -0.2689528042104802, -0.8152919233585878, 0.5564584581535256, -0.780339826943267, -0.3281732447508011, -1.3755710009590292, 0.5645679256513442, 1.9310980903122275, 0.20656457643922052, -0.4250461718200006, -0.47284665437569073, 0.30194166899175495, -1.3440130536812427, 1.521203170099719, -0.10132434966525632, -0.36204337485063837, -1.0459398133624116, 0.5658347190762375, -1.7190273618586744, -1.0701052212989584, 2.7082110310499172, 0.5529878404514403, 0.15211219513483829, -1.6326087856886013, 0.03478102849762877, 0.7565628161581287, 1.0684538622609319, 0.47354641873632536, 0.6243133729787795, 0.45550356353498445, -0.6018161212085049, 0.8217207805227439, 0.31672842683385677, -1.7801296071310975, -0.12125642856251564, -1.0472709496725188, -0.06374741987920472, 1.7330411586569934, -0.23936227573583582, -2.054854882780144],
  StateCode: ['AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'DC', 'FL', 'GA', 'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD', 'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ', 'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY'],
  Unemployment: [0.2102695032076545, 3.154042548114815, 0.7359432612267903, -0.5256737580191357, 0.6308085096229625, -1.4718865224535806, 0.5256737580191357, 0.42053900641530806, 1.9975602804727155, 0, 0.5256737580191357, -1.8924255288688892, -1.0513475160382715, 0.8410780128306171, -0.7359432612267903, -1.1564822676420987, -0.6308085096229631, 0.7359432612267903, 0.9462127644344438, -0.9462127644344448, -0.10513475160382772, -0.5256737580191357, 0.42053900641530806, -0.7359432612267903, 0.9462127644344438, -0.420539006415309, -0.2102695032076545, -1.3667517708497534, 0.8410780128306171, -1.5770212740574074, 0.42053900641530806, 2.102695032076543, 0.5256737580191357, 0.42053900641530806, -1.6821560256612347, 0.8410780128306171, 0.10513475160382678, -0.10513475160382772, 0.7359432612267903, 0.31540425481148127, 0.10513475160382678, -0.9462127644344448, -0.5256737580191357, 0.10513475160382678, -1.0513475160382715, -1.2616170192459262, -0.420539006415309, 0.6308085096229625, 1.0513475160382715, -0.9462127644344448, 0]
};

const pcaDem1 = doPCA(ndata, {HigherEducation: false, InfantMortality: false, MoreDemocrat: false, MoreDemocrat08: true, MoreDemocrat12: true, MoreDemocrat16: false, Obesity: false, Poverty: false, SNAP: false, Unemployment: false});
const pcaDem2 = doPCA(ndata, {HigherEducation: false, InfantMortality: false, MoreDemocrat: false, MoreDemocrat08: true, MoreDemocrat12: true, MoreDemocrat16: true, Obesity: false, Poverty: false, SNAP: false, Unemployment: false});
const pcaFoo3 = doPCA(ndata, {HigherEducation: true, InfantMortality: true, MoreDemocrat: true, MoreDemocrat08: false, MoreDemocrat12: false, MoreDemocrat16: false, Obesity: true, Poverty: true, SNAP: true, Unemployment: true});

test('doPCA(simple)', t => {
  t.ok(equalishSgn(pcaData0.component0, [0.7071067811865476, 0.7071067811865475]), '#0: component0');
  t.ok(equalishSgn(pcaData0.component1, [0.7071067811865476, -0.7071067811865475]), '#0: component1');
  t.ok(AlmostEqual(pcaData0.variance0, 1.9078947368421055, 0, FLT_EPSILON), '#0: variance0');
  t.ok(AlmostEqual(pcaData0.variance1, 0.09210526315789476, 0, FLT_EPSILON), '#0: variance1');
  t.ok(AlmostEqual(pcaData0.varianceSum, 2, 0, FLT_EPSILON), '#0: varianceSum');
  t.ok(equalishSgn(pcaData0.dataProjected.map(xy => xy[0]), [1, 0.4, 0, -0.4, -1]), '#0: dataProjected0');
  t.ok(equalishSgn(pcaData0.dataProjected.map(xy => xy[1]), [-0.04, 0.16, -0.24, 0.16, -0.04]), '#0: dataProjected1');
  t.ok(equalishSgn(pcaData0.basisVectors.map(xyl => xyl[0]), [-0.7071067811865476, -0.7071067811865476]), '#0: basisVectors[0,1][0]');
  t.ok(equalishSgn(pcaData0.basisVectors.map(xyl => xyl[1]), [0.7071067811865476, -0.7071067811865476]), '#0: basisVectors[0,1][1]');
  t.ok(pcaData0.basisVectors.map(xyl => xyl[2])[0] === 'A', '#0: basisVectors[0][2]');
  t.ok(pcaData0.basisVectors.map(xyl => xyl[2])[1] === 'B', '#0: basisVectors[1][2]');

  t.ok(equalishSgn(pcaDem1.component0, [0.7071067811865476, 0.7071067811865475]), '#1: component0');
  t.ok(equalishSgn(pcaDem1.component1, [0.7071067811865476, -0.7071067811865475]), '#1: component1');
  t.ok(AlmostEqual(pcaDem1.variance0, 1.982228814762986, 0, FLT_EPSILON), '#1: variance0');
  t.ok(AlmostEqual(pcaDem1.variance1, 0.017771185237013945, 0, FLT_EPSILON), '#1: variance1');
  t.ok(AlmostEqual(pcaDem1.varianceSum, 2, 0, FLT_EPSILON), '#1: varianceSum');
  t.ok(equalishSgn(pcaDem1.dataProjected.map(xy => xy[0]),
    [-0.29065439446292535, -0.24783669179896886, -0.13332286651245454, -0.2925870060284772, 0.261615210707052, 0.06100381054220486, 0.21402282392244731, 0.23809498531529522, 1, -0.0042417030675840324, -0.10493711870639423, 0.507262565194193,
      -0.3770026771336578, 0.22926037981869482, -0.0803688980219248, 0.06711990570406869, -0.24897906572592332, -0.26160004544580784, -0.24448451405911054, 0.17276743486098675, 0.28636381574257025, 0.2719554315586578, 0.13184388505763556,
      0.08313786843386686, -0.17577247197765872, -0.082788384239105, -0.12239458017028254, -0.24912469012031394, 0.0912790219057936, 0.06591621537685327, 0.17384133231289686, 0.1288221771413154, 0.30563549877704843, -0.03674091460732674,
      -0.19794208835850194, 0.019408566414221756, -0.4134093863465798, 0.14931935358595383, 0.06920274447912622, 0.31003483467530385, -0.1441793929183599, -0.18618013815885864, -0.24042981715509798, -0.19248177626280163, -0.49012323333307445,
      0.4168540690672061, 0.03510912154418977, 0.16914051906141683, -0.26690833375356415, 0.10079462987176718, -0.4753160127059953]), '#1: dataProjected0');
  t.ok(equalishSgn(pcaDem1.dataProjected.map(xy => xy[1]),
    [0.031972124459016184, 0.0790845219341702, 0.02685906340063564, 0.01227651890083925, 0.011984658720594274, 0.002237365243595445, -0.01189405251377099, -0.02041948383362905, -0.01831699163133961, 0.014327693526201274, 0.013613237097670785,
      -0.007023318134743198, -0.0016764761443466812, -0.031628278991414384, -0.039627153512989566, 0.0009939316597427812, -0.007330962526676531, -0.004610188773913939, 0.04273051332410724, 0.008321460529423407, 0.02063854187160546, -0.00036421922150007625,
      -0.021284483975775165, 0.007611569381999241, 0.041909200064956374, -0.027485844459535856, -0.03987821747770805, -0.007555657837514374, -0.012832851087551951, -0.000697890814464246, 0.03322718730016274, -0.006858864056767804, 0.023940081485412178,
      0.012793388053126615, -0.03541980210933782, 0.015398722129255143, 0.026640017236084147, -0.004856732116327786, -0.006331676060980943, 0.012990139712556503, 0.021696332177474804, -0.02644756697480239, 0.0016924053503708694, 0.007762628179817871,
      -0.07770495546072825, 0.0036988432055288863, 0.01013625920159201, 0.0066086630690304436, -0.0484409217924558, -0.01983931544721844, -0.012619162259480584]), '#1: dataProjected1');
  t.ok(equalishSgn(pcaDem1.basisVectors.map(xyl => xyl[0]), [0.7071067811865475, 0.7071067811865476]), '#1: basisVectors[0,1][0]');
  t.ok(equalishSgn(pcaDem1.basisVectors.map(xyl => xyl[1]), [0.7071067811865475, -0.7071067811865476]), '#1: basisVectors[0,1][1]');
  t.ok(pcaDem1.basisVectors.map(xyl => xyl[2])[0] === 'MoreDemocrat08', '#1: basisVectors[0][2]');
  t.ok(pcaDem1.basisVectors.map(xyl => xyl[2])[1] === 'MoreDemocrat12', '#1: basisVectors[1][2]');

  t.ok(equalishSgn(pcaDem2.component0, [-0.5777555048563541, -0.5813256572889848, -0.572938964276046]), '#2: component0');
  t.ok(equalishSgn(pcaDem2.component1, [-0.5524709597951771, -0.2381769378078575, 0.7987788084817143]), '#2: component1');
  t.ok(AlmostEqual(pcaDem2.variance0, 2.9208896220536373, 0, FLT_EPSILON), '#2: variance0');
  t.ok(AlmostEqual(pcaDem2.variance1, 0.06374743765362204, 0, FLT_EPSILON), '#2: variance1');
  t.ok(AlmostEqual(pcaDem2.varianceSum, 3, 0, FLT_EPSILON), '#2: varianceSum');
  t.ok(equalishSgn(pcaDem2.dataProjected.map(xy => xy[0]),
    [0.2799213093482959, 0.20906634949483366, 0.08734598091815704, 0.2806109890914913, -0.30173931084321337, -0.07367061227552311, -0.20653949028085852, -0.21436940734468168, -1, -0.007106925516706195, 0.07403665870507053, -0.4736655892266524, 0.3650409225239169,
      -0.2298913822920507, 0.11067399886936832, -0.02286161050739789, 0.22930088499798643, 0.2699368044354001, 0.21956772297317675, -0.13997136841614313, -0.30319029340237263, -0.2981029891647016, -0.10069845626491301, -0.07522815212747837, 0.1664079942605996,
      0.11013593771888525, 0.14553072792018806, 0.24664378806456466, -0.08384792083370353, -0.05931180137353243, -0.18103356333275594, -0.13249292981641428, -0.3000700056260831, 0.023515647157189436, 0.25715157538908484, 0.0030676762690415287, 0.3961341404758176,
      -0.156727546596766, -0.057422246530776724, -0.2784479524934349, 0.1339890944494855, 0.22217161236343116, 0.24141512982203261, 0.14655113713885864, 0.39813765705194004, -0.3978520300714632, -0.057552263632825326, -0.18850748522594757, 0.31950073495687664,
      -0.07808491416181743, 0.48253177296251654]), '#2: dataProjected0');
  t.ok(equalishSgn(pcaDem2.dataProjected.map(xy => xy[1]),
    [0.015017947850383143, 0.06325674191355704, 0.06627956340464457, 0.013233078310366377, 0.06309480062238043, 0.01922963804822291, -0.008414460059654148, -0.032102164704791936, 0.01601574989957646, 0.018272275873102577, 0.04346609584399641, -0.03831514064300303,
      0.009122249999340498, -0.000295623598604488, -0.050800768943123686, -0.060236054306997446, 0.021345876396118162, -0.017474114778350966, 0.03758262926177785, -0.0409267814305901, 0.0326195280527589, 0.04162584649978957, -0.044645231634855655, -0.008081839913318746,
      0.017077688675997627, -0.04457843928332406, -0.04165944643616357, -0.0026726993858855225, -0.010870683582195579, -0.008061993926692795, 0.01924593387496863, 0.006385779773705782, 0.002355604656138295, 0.01999181164104517, -0.09261871338091383, -0.028241011681311875,
      0.020833254807538382, 0.012344870217563749, -0.016210681334556155, -0.03577317090188176, 0.015265342167587901, -0.0584366876292656, -0.005703538537676473, 0.061701474819311534, 0.10507636512911497, -0.01781302861349688, 0.03375691494234013, 0.031425256207833395,
      -0.08702214321833952, -0.03322674354203732, -0.02144115742214798]), '#2: dataProjected1');
  t.ok(equalishSgn(pcaDem2.basisVectors.map(xyl => xyl[0]), [-0.5777555048563541, -0.5813256572889848, -0.572938964276046]), '#2: basisVectors[0,1][0]');
  t.ok(equalishSgn(pcaDem2.basisVectors.map(xyl => xyl[1]), [-0.5524709597951771, -0.2381769378078575, 0.7987788084817143]), '#2: basisVectors[0,1][1]');
  t.ok(pcaDem2.basisVectors.map(xyl => xyl[2])[0] === 'MoreDemocrat08', '#2: basisVectors[0][2]');
  t.ok(pcaDem2.basisVectors.map(xyl => xyl[2])[1] === 'MoreDemocrat12', '#2: basisVectors[1][2]');
  t.ok(pcaDem2.basisVectors.map(xyl => xyl[2])[2] === 'MoreDemocrat16', '#2: basisVectors[2][2]');

  t.ok(equalishSgn(pcaFoo3.component0, [-0.43139204172439277, 0.42284232076051037, -0.18734532447125044, 0.4154824160912825, 0.4467502669660177, 0.3921115698852221, 0.27211042823893455]), '#3: component0');
  t.ok(equalishSgn(pcaFoo3.component1, [0.17802748462898874, -0.06769793444096138, 0.6339322247382305, -0.35105190449266616, 0.16489296043896207, 0.41856605024401183, 0.48603340663005234]), '#3: component1');
  t.ok(AlmostEqual(pcaFoo3.variance0, 3.7428363107777805, 0, FLT_EPSILON), '#3: variance0');
  t.ok(AlmostEqual(pcaFoo3.variance1, 1.6439968049873248, 0, FLT_EPSILON), '#3: variance1');
  t.ok(AlmostEqual(pcaFoo3.varianceSum, 7, 0, FLT_EPSILON), '#3: varianceSum');
  t.ok(equalishSgn(pcaFoo3.dataProjected.map(xy => xy[0]),
    [0.6446128297889718, 0.11855206984262583, 0.08923223013194247, 0.5005955550933321, -0.26185796908364545, -0.68283053211061, -0.31319742093254527, 0.18242808092486218, -0.04149599116770904, 0.09977712544805872, 0.38914986204405366, -0.48352405786313474,
      -0.24058862021646324, 0.034315234555610793, 0.1568759315219769, -0.235146564449845, -0.12279840138761362, 0.5200642368173977, 0.8483040782717461, 0.02055481217507558, -0.23034837371471567, -0.5135531419615643, 0.10545235906667395, -0.5063843207877086,
      0.9072023609536384, 0.0415240830765125, -0.2129349193902353, -0.26315554620685994, -0.03736880159763516, -0.645328032254881, -0.3320175301904877, 0.4121750685233409, -0.14289674197021562, 0.19861550208463916, -0.2539930446328658, 0.25300640566637983,
      0.3965783982023986, -0.17354049412892147, 0.15255651229856784, -0.10788860458702032, 0.25597410070817217, -0.0185727536519049, 0.39541577147581486, 0.2095600696377881, -0.5505908919802378, -0.40880543393630375, -0.25746831071356985, -0.29583824404258646,
      0.824121903883852, -0.11773243870623498, -0.30678740052792525]), '#3: dataProjected0');
  t.ok(equalishSgn(pcaFoo3.dataProjected.map(xy => xy[1]),
    [-0.15981622847754207, 0.16067361758925022, 0.11505490955593867, -0.3246306472408634, 0.2712512594713148, -0.04174708430536672, 0.17404778544007596, 0.12561976640404798, 1, 0.10917286445554876, 0.06822492779730054, 0.12673576828107017, -0.27768376794359034,
      0.19669592637774364, -0.28808108199334287, -0.17662560276835887, -0.27998274546075375, -0.09615965232913105, 0.024178460427112324, -0.042292265585964564, 0.06721491906982847, 0.19591140356765877, 0.047195834893423376, -0.09787226395408305, -0.004576543302299276,
      -0.16401485381798697, -0.023309331694247426, -0.37295735636626065, 0.20635119772512683, -0.2179277510880677, 0.07783454135531488, 0.570114747903806, 0.32610918825849866, 0.014935701252030077, -0.4414919755356869, 0.020220323663840654, -0.18969190052902604,
      0.21447548234889496, 0.07390420624282133, 0.2599880810122765, -0.07288581434585716, -0.21600929372502842, -0.21281967349581152, -0.10110147311997252, -0.322597740330001, 0.10844753458073507, -0.06909701372425332, 0.2152805005996009, -0.12344279974588307,
      -0.10522392745864954, -0.3476001599352172]), '#3: dataProjected1');
  t.ok(equalishSgn(pcaFoo3.basisVectors.map(xyl => xyl[0]), [-0.43139204172439277, 0.42284232076051037, -0.18734532447125044, 0.4154824160912825, 0.4467502669660177, 0.3921115698852221, 0.27211042823893455]), '#3: basisVectors[0,1][0]');
  t.ok(equalishSgn(pcaFoo3.basisVectors.map(xyl => xyl[1]), [0.17802748462898874, -0.06769793444096138, 0.6339322247382305, -0.35105190449266616, 0.16489296043896207, 0.41856605024401183, 0.48603340663005234]), '#3: basisVectors[0,1][1]');
  t.ok(pcaFoo3.basisVectors.map(xyl => xyl[2])[0] === 'HigherEducation', '#3: basisVectors[0][2]');
  t.ok(pcaFoo3.basisVectors.map(xyl => xyl[2])[1] === 'InfantMortality', '#3: basisVectors[1][2]');
  t.ok(pcaFoo3.basisVectors.map(xyl => xyl[2])[2] === 'MoreDemocrat', '#3: basisVectors[2][2]');
  t.ok(pcaFoo3.basisVectors.map(xyl => xyl[2])[3] === 'Obesity', '#3: basisVectors[3][2]');
  t.ok(pcaFoo3.basisVectors.map(xyl => xyl[2])[4] === 'Poverty', '#3: basisVectors[4][2]');
  t.ok(pcaFoo3.basisVectors.map(xyl => xyl[2])[5] === 'SNAP', '#3: basisVectors[5][2]');
  t.ok(pcaFoo3.basisVectors.map(xyl => xyl[2])[6] === 'Unemployment', '#3: basisVectors[6][2]');

  t.end();
});
